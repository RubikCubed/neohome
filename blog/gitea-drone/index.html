<!doctype html><html lang=en-au dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en-au"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Private git repository with NixOS, Gitea and Drone &#183; ayats.org</title><meta name=title content="Private git repository with NixOS, Gitea and Drone &#183; ayats.org"><meta name=description content="Tutorial to get started with a self-hosted Git repo with automatic CI, as a Github/Gitlab alternative"><link rel=canonical href=/blog/gitea-drone/><link type=text/css rel=stylesheet href=/css/main.bundle.min.fe55d6f12d2d2e255e5716286799ad15cc522e11824fca6c256aed07a6a05b70710c064ee687aad95b205021be30d92ec0f1207941aaffc7918da302d21cd9e5.css integrity="sha512-/lXW8S0tLiVeVxYoZ5mtFcxSLhGCT8psJWrtB6agW3BxDAZO5oeq2VsgUCG+MNkuwPEgeUGq/8eRjaMC0hzZ5Q=="><script type=text/javascript src=/js/appearance.min.c6198a5ecbc6c7b35a8568d29315f50cf5d775d4461c515a476359767f1a745c245aa83fa96b0c7d83da976cf77481e1fc29537a2391a53ffe69a991638802e6.js integrity="sha512-xhmKXsvGx7NahWjSkxX1DPXXddRGHFFaR2NZdn8adFwkWqg/qWsMfYPal2z3dIHh/ClTeiORpT/+aamRY4gC5g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.6d78c827ca7bcbf72056dbf698bf9aeb759a08966686187deb23f5949f73eca5f39b461284900cdfc08e2976d99eb80a8663648de778ba2a83e633ae16dbfc25.js integrity="sha512-bXjIJ8p7y/cgVtv2mL+a63WaCJZmhhh96yP1lJ9z7KXzm0YShJAM38COKXbZnrgKhmNkjed4uiqD5jOuFtv8JQ==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Private git repository with NixOS, Gitea and Drone"><meta property="og:description" content="Tutorial to get started with a self-hosted Git repo with automatic CI, as a Github/Gitlab alternative"><meta property="og:type" content="article"><meta property="og:url" content="/blog/gitea-drone/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-01-29T15:11:36+00:00"><meta property="article:modified_time" content="2022-01-29T15:11:36+00:00"><meta property="og:site_name" content="ayats.org"><meta name=twitter:card content="summary"><meta name=twitter:title content="Private git repository with NixOS, Gitea and Drone"><meta name=twitter:description content="Tutorial to get started with a self-hosted Git repo with automatic CI, as a Github/Gitlab alternative"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Blog","name":"Private git repository with NixOS, Gitea and Drone","headline":"Private git repository with NixOS, Gitea and Drone","abstract":"Tutorial to get started with a self-hosted Git repo with automatic CI, as a Github\/Gitlab alternative","inLanguage":"en-au","url":"\/blog\/gitea-drone\/","author":{"@type":"Person","name":"Fernando Ayats"},"copyrightYear":"2022","dateCreated":"2022-01-29T15:11:36\u002b00:00","datePublished":"2022-01-29T15:11:36\u002b00:00","dateModified":"2022-01-29T15:11:36\u002b00:00","keywords":["nix","cloud"],"mainEntityOfPage":"true","wordCount":"1151"}]</script><meta name=author content="Fernando Ayats"><link href=https://twitter.com/ rel=me><link href=https://facebook.com/ rel=me><link href=https://linkedin.com/ rel=me><link href=https://youtube.com/ rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>ayats.org</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 group sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a href=/blog/ title=Blog><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="mb-1 group sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button-1 title="Search (/)">
<span class="transition-colors group-dark:hover:text-primary-400 group-hover:text-primary-600"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Welcome to Congo! :tada:</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/blog/>Blog</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/blog/gitea-drone/>Private git repository with NixOS, Gitea and Drone</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Private git repository with NixOS, Gitea and Drone</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-01-29 15:11:36 +0000 UTC">29 January 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="min-w-0 min-h-0 max-w-fit grow"><p>In this post I want to show you how I set up a NixOS server running a private Gitea instance, with CI pipelines using Drone, all tied together with Nginx, PostgreSQL and sops-nix. With this setup you would have:</p><ul><li>A private Git repository to upload your projects, with a nice web interface.</li><li>CI/CD pipelines, with a similiar behaviour to GitHub&rsquo;s or Gitlab&rsquo;s.</li></ul><p>This guide is also oriented at a hobbist setup, where the approach is to keep the configuration as simple as posible.</p><h2 id=server class="relative group">Server <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#server aria-label=Anchor>#</a></span></h2><p>This guide assumes that you already have a machine to deploy your NixOS configurations to, and that you have a working minimial configuration. To do so, there are some NixOS-native projects that can help you, such as:</p><ul><li><a href=https://github.com/NixOS/nixops target=_blank rel="noreferrer noopener">NixOps</a></li><li><a href=https://github.com/serokell/deploy-rs target=_blank rel="noreferrer noopener">deploy-rs</a> (check out my guide <a href=https://ayats.org/blog/deploy-rs-example/ target=_blank rel="noreferrer noopener">here</a>)</li></ul><p>Whichever solution you use, you can adapt and drop this configuration files, and then import them from your main <code>configuration.nix</code>.</p><h2 id=sops-nix class="relative group">sops-nix <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sops-nix aria-label=Anchor>#</a></span></h2><p>To deploy secrets to our machine, we could think of these options:</p><ul><li>Write our secrets directly into <code>configuration.nix</code></li><li>Write our secrets into a file in the machine, (such as <code>/secret/my-secret</code>), and reference that file in <code>configuration.nix</code></li></ul><p><a href=https://github.com/Mic92/sops-nix target=_blank rel="noreferrer noopener">sops-nix</a> uses a <strong>hybrid</strong> approach: our secrets will be stored encrypted in our configuration. When the machine boots up, it try to decrypt them using the age key, and put them into a specific path (<code>config.sops.secrets.&lt;my-secret>.path</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl><span class=p>{</span> <span class=n>config</span><span class=o>,</span> <span class=n>pkgs</span><span class=o>,</span> <span class=o>...</span> <span class=p>}:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>sops</span><span class=o>.</span><span class=n>age</span><span class=o>.</span><span class=n>keyFile</span> <span class=o>=</span> <span class=s2>&#34;/secrets/age/keys.txt&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>If you prefer to configure your secrets in another way, make sure to replace the lines that use sops with your solution. However, if you want to use sops, read the upstream documentation to get started.</p><h2 id=gitea class="relative group">Gitea <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#gitea aria-label=Anchor>#</a></span></h2><p>NixOS provides a <strong>module</strong> to setup Gitea. We only need to add the postgres configuration, and our password via sops. Note that this configuration was taken by <a href=https://mcwhirter.com.au/craige/blog/2019/Deploying_Gitea_on_NixOS target=_blank rel="noreferrer noopener">this post by Craige McWhirter</a>, without much modification.</p><p>The service will listen on the port <code>3001</code>, where it will receive the http requests forwarded by nginx.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl><span class=p>{</span> <span class=n>config</span><span class=o>,</span> <span class=n>pkgs</span><span class=o>,</span> <span class=o>...</span> <span class=p>}:</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>services</span><span class=o>.</span><span class=n>nginx</span><span class=o>.</span><span class=n>virtualHosts</span><span class=o>.</span><span class=s2>&#34;git.my-domain.tld&#34;</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enableACME</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>forceSSL</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>locations</span><span class=o>.</span><span class=s2>&#34;/&#34;</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>proxyPass</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:3001/&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>services</span><span class=o>.</span><span class=n>postgresql</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>authentication</span> <span class=o>=</span> <span class=s1>&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>      local gitea all ident map=gitea-users
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>identMap</span> <span class=o>=</span> <span class=c1># Map the gitea user to postgresql &#39;&#39;</span>
</span></span><span class=line><span class=cl>      <span class=n>gitea-users</span> <span class=n>gitea</span> <span class=n>gitea</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;;
</span></span></span><span class=line><span class=cl><span class=s1>  };
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>  sops.secrets.&#34;postgres/gitea_dbpass&#34; = {
</span></span></span><span class=line><span class=cl><span class=s1>    sopsFile = ../.secrets/postgres.yaml; # bring your own password file
</span></span></span><span class=line><span class=cl><span class=s1>    owner = config.users.users.gitea.name;
</span></span></span><span class=line><span class=cl><span class=s1>  };
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>  services.gitea = {
</span></span></span><span class=line><span class=cl><span class=s1>    enable = true;
</span></span></span><span class=line><span class=cl><span class=s1>    appName = &#34;My awesome Gitea server&#34;; # Give the site a name
</span></span></span><span class=line><span class=cl><span class=s1>    database = {
</span></span></span><span class=line><span class=cl><span class=s1>      type = &#34;postgres&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>      passwordFile = config.sops.secrets.&#34;postgres/gitea_dbpass&#34;.path;
</span></span></span><span class=line><span class=cl><span class=s1>    };
</span></span></span><span class=line><span class=cl><span class=s1>    domain = &#34;git.my-domain.tld&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>    rootUrl = &#34;https://git.my-domain.tld/&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>    httpPort = 3001;
</span></span></span><span class=line><span class=cl><span class=s1>  };
</span></span></span><span class=line><span class=cl><span class=s1>}
</span></span></span></code></pre></div><h2 id=drone class="relative group">Drone <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#drone aria-label=Anchor>#</a></span></h2><p>Drone is a piece of software that will perform our CI/CD pipelines. It is very similiar to how GitHub&rsquo;s actions or Gitlab&rsquo;s pipelines work, so:</p><ol><li>We create a <code>.drone.yml</code> file in the root of a repository.</li><li>This file defines some job(s) to execute under certain conditions, such as this example:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>pipeline</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>exec</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>os</span><span class=p>:</span><span class=w> </span><span class=l>linux</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>arch</span><span class=p>:</span><span class=w> </span><span class=l>amd64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>main-step</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>MY_SECRET</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>from_secret</span><span class=p>:</span><span class=w> </span><span class=l>MY_SECRET</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>commands</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>nix run .#run-my-app</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>Gitea&rsquo;s web interface will detect our jobs, and show a symbol with the job status, and a shortcut to Drone&rsquo;s control panel.</li></ol><p>To configure this, we need at least two components:</p><ul><li>The server: will communicate between Gitea and the runners</li><li>The runners: will perform the builds. There are a <a href=https://docs.drone.io/runner/overview/ target=_blank rel="noreferrer noopener">many runners</a> , but in this example I set-up two of them:<ul><li>Docker runner, to run jobs inside docker containers</li><li>Exec runner, to use the server&rsquo;s nix store (this results in cached results, environments, etc)</li></ul></li></ul><p>As there is no Drone module at the time of writing, I configured these systemd services based on <a href=https://github.com/Mic92/dotfiles/tree/035a2c22e161f4fbe4fcbd038c6464028ddce619/nixos/eve/modules/drone target=_blank rel="noreferrer noopener">Mic92&rsquo;s dotifiles</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl><span class=p>{</span> <span class=n>config</span><span class=o>,</span> <span class=n>pkgs</span><span class=o>,</span> <span class=o>...</span> <span class=p>}:</span>
</span></span><span class=line><span class=cl><span class=k>let</span>
</span></span><span class=line><span class=cl>  <span class=n>droneserver</span> <span class=o>=</span> <span class=n>config</span><span class=o>.</span><span class=n>users</span><span class=o>.</span><span class=n>users</span><span class=o>.</span><span class=n>droneserver</span><span class=o>.</span><span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>in</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>users</span><span class=o>.</span><span class=n>droneserver</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>isSystemUser</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>createHome</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>droneserver</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>groups</span><span class=o>.</span><span class=n>droneserver</span> <span class=o>=</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>services</span><span class=o>.</span><span class=n>nginx</span><span class=o>.</span><span class=n>virtualHosts</span><span class=o>.</span><span class=s2>&#34;drone.my-server.tld&#34;</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enableACME</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>forceSSL</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>locations</span><span class=o>.</span><span class=s2>&#34;/&#34;</span><span class=o>.</span><span class=n>proxyPass</span> <span class=o>=</span> <span class=s2>&#34;http://localhost:3030/&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>services</span><span class=o>.</span><span class=n>postgresql</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ensureDatabases</span> <span class=o>=</span> <span class=p>[</span> <span class=n>droneserver</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ensureUsers</span> <span class=o>=</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=n>droneserver</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>ensurePermissions</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DATABASE </span><span class=si>${</span><span class=n>droneserver</span><span class=si>}</span><span class=s2>&#34;</span> <span class=o>=</span> <span class=s2>&#34;ALL PRIVILEGES&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>}];</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Secrets configured:</span>
</span></span><span class=line><span class=cl>  <span class=c1># - DRONE_GITEA_CLIENT_ID</span>
</span></span><span class=line><span class=cl>  <span class=c1># - DRONE_GITEA_CLIENT_SECRET</span>
</span></span><span class=line><span class=cl>  <span class=c1># - DRONE_RPC_SECRET</span>
</span></span><span class=line><span class=cl>  <span class=c1># To get these secrets, please check Drone&#39;s documentation for Gitea integration:</span>
</span></span><span class=line><span class=cl>  <span class=c1># https://docs.drone.io/server/provider/gitea/</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>sops</span><span class=o>.</span><span class=n>secrets</span><span class=o>.</span><span class=n>drone</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>sopsFile</span> <span class=o>=</span> <span class=sr>../.secrets/drone.yaml</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>systemd</span><span class=o>.</span><span class=n>services</span><span class=o>.</span><span class=n>drone-server</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>wantedBy</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>&#34;multi-user.target&#34;</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>serviceConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>EnvironmentFile</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span><span class=o>.</span><span class=n>sops</span><span class=o>.</span><span class=n>secrets</span><span class=o>.</span><span class=n>drone</span><span class=o>.</span><span class=n>path</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>Environment</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_DATABASE_DATASOURCE=postgres:///droneserver?host=/run/postgresql&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_DATABASE_DRIVER=postgres&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_SERVER_PORT=:3030&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_USER_CREATE=username:viperML,admin:true&#34;</span> <span class=c1># set your admin username</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_GITEA_SERVER=https://git.my-domain.tld&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_SERVER_HOST=drone.my-domain.tld&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_SERVER_PROTO=https&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>ExecStart</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=n>pkgs</span><span class=o>.</span><span class=n>drone</span><span class=si>}</span><span class=s2>/bin/drone-server&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>User</span> <span class=o>=</span> <span class=n>droneserver</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>Group</span> <span class=o>=</span> <span class=n>droneserver</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>### Docker runner</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>users</span><span class=o>.</span><span class=n>drone-runner-docker</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>isSystemUser</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=s2>&#34;drone-runner-docker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>groups</span><span class=o>.</span><span class=n>drone-runner-docker</span> <span class=o>=</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=c1># Allow the runner to use docker</span>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>groups</span><span class=o>.</span><span class=n>docker</span><span class=o>.</span><span class=n>members</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>&#34;drone-runner-docker&#34;</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>systemd</span><span class=o>.</span><span class=n>services</span><span class=o>.</span><span class=n>drone-runner-docker</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enable</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>wantedBy</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>&#34;multi-user.target&#34;</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>### MANUALLY RESTART SERVICE IF CHANGED</span>
</span></span><span class=line><span class=cl>    <span class=n>restartIfChanged</span> <span class=o>=</span> <span class=no>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>serviceConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Environment</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RPC_PROTO=http&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RPC_HOST=localhost:3030&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RUNNER_CAPACITY=2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RUNNER_NAME=drone-runner-docker&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>EnvironmentFile</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span><span class=o>.</span><span class=n>sops</span><span class=o>.</span><span class=n>secrets</span><span class=o>.</span><span class=n>drone</span><span class=o>.</span><span class=n>path</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>ExecStart</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=n>pkgs</span><span class=o>.</span><span class=n>drone-runner-docker</span><span class=si>}</span><span class=s2>/bin/drone-runner-docker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>User</span> <span class=o>=</span> <span class=s2>&#34;drone-runner-docker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>Group</span> <span class=o>=</span> <span class=s2>&#34;drone-runner-docker&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>### Exec runner</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>users</span><span class=o>.</span><span class=n>drone-runner-exec</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>isSystemUser</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=s2>&#34;drone-runner-exec&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=o>.</span><span class=n>groups</span><span class=o>.</span><span class=n>drone-runner-exec</span> <span class=o>=</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=c1># Allow the exec runner to write to build with nix</span>
</span></span><span class=line><span class=cl>  <span class=n>nix</span><span class=o>.</span><span class=n>allowedUsers</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>&#34;drone-runner-exec&#34;</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>systemd</span><span class=o>.</span><span class=n>services</span><span class=o>.</span><span class=n>drone-runner-exec</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enable</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>wantedBy</span> <span class=o>=</span> <span class=p>[</span> <span class=s2>&#34;multi-user.target&#34;</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=c1>### MANUALLY RESTART SERVICE IF CHANGED</span>
</span></span><span class=line><span class=cl>    <span class=n>restartIfChanged</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>confinement</span><span class=o>.</span><span class=n>enable</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>confinement</span><span class=o>.</span><span class=n>packages</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>git</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>gnutar</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>bash</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>nixFlakes</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>gzip</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>path</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>git</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>gnutar</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>bash</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>nixFlakes</span>
</span></span><span class=line><span class=cl>      <span class=n>pkgs</span><span class=o>.</span><span class=n>gzip</span>
</span></span><span class=line><span class=cl>    <span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>serviceConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>Environment</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RPC_PROTO=http&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RPC_HOST=127.0.0.1:3030&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RUNNER_CAPACITY=2&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_RUNNER_NAME=drone-runner-exec&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;NIX_REMOTE=daemon&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;PAGER=cat&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;DRONE_DEBUG=true&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>BindPaths</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/nix/var/nix/daemon-socket/socket&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/run/nscd/socket&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># &#34;/var/lib/drone&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>BindReadOnlyPaths</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/etc/passwd:/etc/passwd&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/etc/group:/etc/group&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/nix/var/nix/profiles/system/etc/nix:/etc/nix&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;</span><span class=si>${</span><span class=n>config</span><span class=o>.</span><span class=n>environment</span><span class=o>.</span><span class=n>etc</span><span class=o>.</span><span class=s2>&#34;ssl/certs/ca-certificates.crt&#34;</span><span class=o>.</span><span class=n>source</span><span class=si>}</span><span class=s2>:/etc/ssl/certs/ca-certificates.crt&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;</span><span class=si>${</span><span class=n>config</span><span class=o>.</span><span class=n>environment</span><span class=o>.</span><span class=n>etc</span><span class=o>.</span><span class=s2>&#34;ssh/ssh_known_hosts&#34;</span><span class=o>.</span><span class=n>source</span><span class=si>}</span><span class=s2>:/etc/ssh/ssh_known_hosts&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;</span><span class=si>${</span><span class=nb>builtins</span><span class=o>.</span><span class=n>toFile</span> <span class=s2>&#34;ssh_config&#34;</span> <span class=s1>&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>          Host git.ayats.org
</span></span></span><span class=line><span class=cl><span class=s1>          ForwardAgent yes
</span></span></span><span class=line><span class=cl><span class=s1>        &#39;&#39;</span><span class=si>}</span><span class=s2>:/etc/ssh/ssh_config&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/etc/machine-id&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/etc/resolv.conf&#34;</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;/nix/&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>EnvironmentFile</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span><span class=o>.</span><span class=n>sops</span><span class=o>.</span><span class=n>secrets</span><span class=o>.</span><span class=n>drone</span><span class=o>.</span><span class=n>path</span>
</span></span><span class=line><span class=cl>      <span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>ExecStart</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=n>pkgs</span><span class=o>.</span><span class=n>drone-runner-exec</span><span class=si>}</span><span class=s2>/bin/drone-runner-exec&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>User</span> <span class=o>=</span> <span class=s2>&#34;drone-runner-exec&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>Group</span> <span class=o>=</span> <span class=s2>&#34;drone-runner-exec&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>Note: this setup runs both Gitea and Drone in the same machine. It could be beneficial to have different machines for each service, being for performance or security reasons.</p></blockquote><h2 id=nginx-acme-postgres-docker class="relative group">Nginx, ACME, Postgres, Docker <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#nginx-acme-postgres-docker aria-label=Anchor>#</a></span></h2><p>Finally, to tie everything together, we set up a basic Nginx service, that proxies the requests to the virtual hosts, to the internal services. Remember to punch a hole in your firewall, as by default, the firewall is enabled with the ports closed!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nix data-lang=nix><span class=line><span class=cl><span class=p>{</span> <span class=n>config</span><span class=o>,</span> <span class=n>pkgs</span><span class=o>,</span> <span class=o>...</span> <span class=p>}:</span>
</span></span><span class=line><span class=cl>  <span class=n>networking</span><span class=o>.</span><span class=n>firewall</span><span class=o>.</span><span class=n>allowedTCPPorts</span> <span class=err>=</span> <span class=p>[</span> <span class=mi>80</span> <span class=mi>443</span> <span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>services</span><span class=o>.</span><span class=n>nginx</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enable</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendedGzipSettings</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendedOptimisation</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendedProxySettings</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>recommendedTlsSettings</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>security</span><span class=o>.</span><span class=n>acme</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>acceptTerms</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>certs</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;git.my-domain.tld&#34;</span><span class=o>.</span><span class=n>email</span> <span class=o>=</span> <span class=s2>&#34;foo@bar.com&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;drone.my-domain.tld&#34;</span><span class=o>.</span><span class=n>email</span> <span class=o>=</span> <span class=s2>&#34;foo@bar.com&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>services</span><span class=o>.</span><span class=n>postgresql</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enable</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>virtualisation</span><span class=o>.</span><span class=n>docker</span> <span class=err>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>enable</span> <span class=o>=</span> <span class=no>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span></code></pre></div><h2 id=finale class="relative group">Finale <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#finale aria-label=Anchor>#</a></span></h2><p>I hope that this helps you set-up your Gitea server. This write-up is based on my own configuration, with some simplifications. You can check the whole flake here: <a href=https://github.com/viperML/infra/tree/8a876582bd881ad01f58081a529d68019040ef8a target=_blank rel="noreferrer noopener">github.com/viperML/infra</a>.If you find any errors or suggestions, please submit a issue or pull request at the repo of this blog: <a href=https://github.com/viperML/home target=_blank rel="noreferrer noopener">github.com/viperML/home</a>.</p></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 alt="Fernando Ayats" src=/img/author_hu052d24d60828c1cca42a6aefe45b8b44_54195_192x192_fill_q75_box_smart1.jpg><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Fernando Ayats</div><div class="text-sm text-neutral-700 dark:text-neutral-400">This is an example author bio, and although there&rsquo;s a stock photo of a dog here, this article was actually created by a human. 🐶</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://twitter.com/ target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://facebook.com/ target=_blank aria-label=Facebook rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://linkedin.com/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://youtube.com/ target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg></span></a></div></div></div></div></footer></article></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2023 Fernando Ayats</p></div><div class="cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex items-center justify-center w-12 h-12 dark:hidden" title="Switch to dark appearance"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden w-12 h-12 dark:flex" title="Switch to light appearance"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>